<div>
  <h2 class="header-title">Find and select your favorite movies to proceed</h2>

  <form
    [formGroup]="searchForm"
    (ngSubmit)="onSearch()"
    class="search-form-container"
  >
    <div class="search-form-field">
      <clr-select-container>
        <label>Genre</label>
        <select clrSelect name="options" formControlName="genre">
          <option *ngFor="let genre of genres$ | async" [value]="genre.id">
            {{ genre.name }}
          </option>
        </select>
      </clr-select-container>
    </div>

    <div class="search-form-field">
      <label for="basic" class="clr-control-label">Year</label>
      <div class="clr-control-container">
        <div class="clr-input-wrapper">
          <input
            type="text"
            id="basic"
            class="clr-input"
            formControlName="year"
          />
          <cds-icon
            class="clr-validate-icon"
            shape="exclamation-circle"
          ></cds-icon>
        </div>
      </div>
    </div>

    <div
      *ngIf="searchForm.value.genre && searchForm.value.year"
      class="search-form-field"
    >
      <label for="basic" class="clr-control-label">Title</label>
      <div class="clr-control-container">
        <div class="clr-input-wrapper">
          <input
            type="text"
            id="basic"
            class="clr-input"
            formControlName="title"
          />
          <cds-icon
            class="clr-validate-icon"
            shape="exclamation-circle"
          ></cds-icon>
        </div>
      </div>
    </div>

    <button
      *ngIf="hasSearched"
      class="btn btn-danger-outline btn-sm search-button"
      (click)="clearSearch()"
    >
      Clear
    </button>
  </form>

  <ng-container *ngIf="movies$ | async as movies; else noResults">
    <ul *ngIf="movies.length > 0; else noResults">
      <li *ngFor="let movie of movies">
        <div>
          <div
            class="poster-container"
            [class.selected]="isMovieSelected(movie)"
          >
            <img
              [src]="'https://image.tmdb.org/t/p/w500' + movie.poster_path"
              alt="{{ movie.title }}"
              class="poster-image"
              (error)="fallbackImage($event, movie)"
            />
          </div>
          <div class="movie-info">
            <span>
              <button
                class="add-button-container"
                mat-icon-button
                color="accent"
                [disabled]="isMovieSelected(movie)"
                (click)="selectMovies(movie)"
              >
                <mat-icon>add_circle_outline</mat-icon>
              </button></span
            >
          </div>
        </div>
        <p
          class="movie-title"
          *ngIf="shouldShowEllipsis(movie.title)"
          matTooltip="{{ movie.title }}"
        >
          {{ movie.title | slice : 0 : 16 }}...
        </p>
        <p class="movie-title" *ngIf="!shouldShowEllipsis(movie.title)">
          {{ movie.title }}
        </p>
      </li>
    </ul>
  </ng-container>

  <ng-template #noResults>
    <div class="no-results-container">
      <img
        src="./../../../assets/images/not-found.png"
        alt="No results found"
      />
    </div>
  </ng-template>

  <div class="next-button">
    <button
      mat-raised-button
      (click)="saveMovies()"
      color="primary"
      class="next-button"
    >
      Next
    </button>
  </div>

  <div class="tmdb-api-credits">
    <span>
      API Powered by
      <a a href="https://www.themoviedb.org/" target="_blank"
        ><img class="tmdb-logo" src="./../../../assets/images/tmdb-logo-2.svg"
      /></a>
    </span>
  </div>
</div>
